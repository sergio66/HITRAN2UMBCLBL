Contents
---------
1) Running eg clust_runXtopts_savegas1_file.m via sergio_matlab_chip_makegas1_103.sbatch
2) Checking which files have been made ....
3) Putting together the files (in this casem 11 T and 5 P) prior to compression
4) Compress the files
5) Convert to F77/F90 binary files ( <<< automatically put into /asl/data/kcarta >>> )
6) Testing compressed H2020 vs H2024

If you have just cloned UMBC_LBL and HITRAN2UMBCLBL, make sure you
  mkdir /home/sergio/git/UMBC_LBL/IPFILES
since the profile files are written there

Also edit
  addpath0.m
since it does this
  addpath /home/sergio/SPECTRA
  addpath /home/sergio/git/matlabcode/matlibSergio/matlib/science
  addpath /home/sergio/git/matlabcode/matlibSergio/matlib/aslutil

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

1) Running eg clust_runXtopts_savegas1_file.m via sergio_matlab_chip_makegas1_103.sbatch
----------------------------------------------------------------------------------------

GAS 1

>>>>>>>>>>>>>>>>>>>>>>>>>
%% for high res heating rates ....
Set dirnames in freq_boundaries_g1_LBL.m
                freq_boundaries_g103_LBL.m
and have moved them to

[sergio@c24-52 MAKEIR_WV_H24]$ ls -lt HIGHRES_LBL/
total 24
-rw-rw-r-- 1 sergio pi_strow  872 Nov 23 03:45 freq_boundaries_g1_LBL.m
-rw-rw-r-- 1 sergio pi_strow 2083 Feb 29  2016 runXtopts_mkg103vfilesLBL.m
-rw-rw-r-- 1 sergio pi_strow 3758 Feb 29  2016 clust_runXtopts_savegas103_file_HIGHRES.m
-rw-rw-r-- 1 sergio pi_strow  752 Feb 29  2016 freq_boundaries_g103_LBL.m
-rw-rw-r-- 1 sergio pi_strow 2055 Feb 28  2016 runXtopts_mkg1vfilesLBL.m
-rw-rw-r-- 1 sergio pi_strow 3479 Feb 28  2016 clust_runXtopts_savegas1_file_HIGHRES.m
>>>>>>>>>>>>>>>>>>>>>>>>>

1) Set 2024 dirnames in freq_boundaries_g1.m    this does 605-2830 cm-1
                        freq_boundaries_g103.m  this does 2 main bands, mid wave and SWIR so you have to run twice
                        freq_boundaries_g110.m  this does 605-2830 cm-1
We are putting data into
  /umbc/rs/pi_sergio/WorkDirDec2025/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat
  /umbc/rs/pi_sergio/WorkDirDec2025/H2024_RUN8_NIRDATABASE/IR_605_2830/g103.dat
  /umbc/rs/pi_sergio/WorkDirDec2025/H2024_RUN8_NIRDATABASE/IR_605_2830/g110.dat

2) Then edit H12 --> H16 --> H20 --> H24 in 
   filelist_g1.m
   filelist_g103.m
   filelist_g110.m 
namely
  %cd /home/sergio/HITRAN2UMBCLBL/MAKEIR/H2016/MAKEIR_WV_H16/
  %cd /home/sergio/HITRAN2UMBCLBL/MAKEIR/H2020/MAKEIR_WV_H20/
  cd /home/sergio/HITRAN2UMBCLBL/MAKEIR/H2024/MAKEIR_WV_H24/

<< very importantly, makes   jobs_not_done.sc  >>
<<    so you can very easily checks which files have been run and just run the jobs you need to complete all files, >>
<<    rather than all 990 jobs submitted >>

3) NO NEED NO NEED NO NEED >>>>>>>>>>>>>>>>>>>>>>>>>
   run theese  files to make the file lists
      run loop_filelist_gN.m which generates a list of
  ~20000 gas =  90 freqchunk x 11 Toffsets x 5 PPoffsets to be done
3) NO NEED NO NEED NO NEED >>>>>>>>>>>>>>>>>>>>>>>>>

4) Use the HPC cluster to run sergio_matlab_chip_makegas1_103.sbatch
  sbatch --array=1-990%128 --output='/dev/null' sergio_matlab_chip_makegas1_103.sbatch
which calls one of
  clust_runXtopts_savegas1_file.m
  clust_runXtopts_savegas103_file.m
  clust_runXtopts_savegas110_file.m

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

2) Checking which files have been made ....
--------------------------------------------

update "gas_done_already_g1_OR_g103.m" so
  it gets the correct dirout; (actually no need to do this as correctly set in freq_boundaries_gX)
     H12 --> H16 --> H20 --> H24     lines = show_vis_ir_lines_wavenumber_water(2020,7,gasidx,iso)
  
gas_done_already_g1_OR_g103(1,-1);        % to keep the empty files
gas_done_already_g1_OR_g103(103,-1);      % to keep the empty files
gas_done_already_g1_OR_g103(110,-1);      % to keep the empty files

[~,~,lines001] = gas_done_already_g1_OR_g103(001);
[~,~,lines103] = gas_done_already_g1_OR_g103(103);
[~,~,lines110] = gas_done_already_g1_OR_g103(110);
lines001.linct + lines103.linct - lines110.linct
semilogy(lines001.wnum,lines001.stren,'b.',lines103.wnum,lines103.stren*1e0,'k+',lines110.wnum,lines110.stren*1,'c--')
semilogy(lines001.wnum,lines001.stren,'b.',lines103.wnum,lines103.stren*1e0,'k+',lines110.wnum,lines110.stren*0,'r')

%%%%%%%%%%%%%%%%%%%%%%%%%

First do
  gas_done_already_g1_OR_g103(1,2024,+1);   % to rm   the empty files  
  gas_done_already_g1_OR_g103(103,2024,+1); % to rm   the empty files  
  gas_done_already_g1_OR_g103(110,2024,+1); % to rm   the empty files  
Then run
   filelist_g1.m
   filelist_g103.m
   filelist_g110.m 
since they
<< very importantly, makes   jobs_not_done.sc  >>
<<    so you can very easily checks which files have been run and just run the jobs you need to complete all files, >>
<<    rather than all 990 jobs submitted >>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

3) Putting together the files (in this casem 11 T and 5 P) prior to compression
-------------------------------------------------------------------------------

runXtopts_mkg1vfiles.m   puts together eveything for g1
runXtopts_mkg103vfiles.m puts together eveything for g103
runXtopts_mkg110vfiles.m puts together eveything for g110

>>>>>>>>>>>>>>>>>>>>>>>>>
then can check the ODs
addpath /home/sergio/KCARTA/MATLAB
[d12x,w] = readkcstd('/home/sergio/KCARTA/UTILITY/l2s_kc120_H12.dat');
[d16x,w] = readkcstd('/home/sergio/KCARTA/UTILITY/l2s_kc120_H16.dat');
[d20x,w] = readkcstd('/home/sergio/KCARTA/UTILITY/l2s_kc120_H20.dat');
for ii = 1 : 70; 
  figure(1); semilogy(w,d12x(:,ii),w,d16x(:,ii)); title(num2str(ii));
  figure(2); plot(w,d12x(:,ii)-d16x(:,ii)); title(num2str(ii));  
  disp(;ret to continue'); pause
end

%% raw data from run8water
chunk = 2530;

g110  = load(['/asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g110.dat/stdH2OALL' num2str(chunk) '_1_6_2.mat']);
g1    = load(['/asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/stdH2O' num2str(chunk) '_1_6_2.mat']);
g103  = load(['/asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g103.dat/stdHDO' num2str(chunk) '_1_6_2.mat']);
plot(g1.w,(g1.d + g103.d) - g110.d)
semilogy(g1.w,g1.d(1,:),'b.',g1.w,g103.d(1,:),'g',g1.w,g110.d(1,:),'r',g1.w,g1.d(1,:)+g103.d(1,:),'m.')

%% compressed data
cg1   = load(['/asl/s1/sergio/H2020_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o/cg1v' num2str(chunk) '.mat']);
cg103 = load(['/asl/s1/sergio/H2020_RUN8_NIRDATABASE/IR_605_2830/g103.dat/kcomp.h2o/cg103v' num2str(chunk) '.mat']);
cg1x   = squeeze(cg1.kcomp(:,:,6,2));   cg1x   = (cg1.B   * cg1x).^4;   cg1x = cg1x';
cg103x = squeeze(cg103.kcomp(:,:,6,2)); cg103x = (cg103.B * cg103x).^4; cg103x = cg103x';

%% compare raw against compressed
semilogy(g1.w,g1.d(1,:),'bo-',g1.w,cg1x(1,:),'r',g1.w,g103.d(1,:),'cx-',g1.w,cg103x(1,:),'m')
semilogy(g1.w,(g1.d(1,:)+g103.d(1,:)),'bo-',g1.w,(cg1x(1,:)+cg103x(1,:)),'rx-',g1.w,g110.d(1,:),'k')
wah = find(w >= min(g1.w-0.0025/2) & w <= max(g1.w+0.0025/2)); whos wah
semilogy(g1.w,sum(g110.d(4:100,:)),'bx-',g1.w,d20x(wah,1)+d20x(wah,70),'r')
>>>>>>>>>>>>>>>>>>>>>>>>>


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

4) Compress the files
---------------------

cd /home/sergio/HITRAN2UMBCLBL/CMPRUN

cp /umbc/rs/pi_sergio/WorkDirDec2025/HITRAN2UMBCLBL/MAKEIR/H2024/MAKEIR_WV_H24/addpath0.m .
  fix the paths there if needed
  
cp cmprunIR_WV_H20.m cmprunIR_WV_H24.m
  heavily edit so can do one or all of g1,103,110 as wanted

ls -lt cmprunIR_WV.m (hopefully a symbolic link)
rm cmprunIR_WV.m (hopefully a symbolic link)
ln -s cmprunIR_WV_H24.m cmprunIR_WV.m

cmprunIR_WV(1,605:25:2830,1);
  %% will mkdir making  /asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o/
  %% and then compress g1 and put there
cmprunIR_WV([1 103],605:25:2830);
  %% will mkdir making  /asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o/
  %% will mkdir making  /asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o/  
  %% and then compress g1 and put there

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

5) Convert to F77/F90 binary files ( <<< automatically put into /asl/data/kcarta >>> )
-----------------------------------------------------------------------------------------

cd /home/sergio/HITRAN2UMBCLBL/FORTRAN/mat2for
cp loop_mat2forIR_WV_H20.m loop_mat2forIR_WV_H24.m
  edit gasID_1_cdir_fdir
    %% cdir = '/asl/s1/sergio/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o/';
    cdir = /umbc/rs/pi_sergio/WorkDirDec2025/H2024_RUN8_NIRDATABASE/IR_605_2830/g1.dat/kcomp.h2o//cg103v2805.mat  
    %% fdir = '/asl/data/kcarta/H2024.ieee-le/IR605/hdo.ieee-le/';
    fdir = '//umbc/xfs3/strow/asl/rta/kcarta/H2024.ieee-le/IR605/hdo.ieee-le/';

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

6) Testing compressed H2020 vs H2024
------------------------------------

Run
  test_HXYa_vs_HXYb_WV_HDO.m
